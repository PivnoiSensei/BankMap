# Звіт за першим завданням
## 1. Обрана бібліотека для роботи з картою від OpenStreetMap
Я почав розглядати можливі бібліотеки для відтворення карти з дослідження того, як на сайті-ресурсі:
`https://tile.openstreetmap.org.ua`
було реалізовано її векторний варіант, а саме через бібліотеку Maplibre. Бібліотека Leaflet, що використовується у поточній версії карти не підходить через її обмеженість у роботі лише с растровими тайлами і складною кастомізацією відображення інформації на карті. 
Обрана бібліотека `MapLibre` не лише має обширні можливості для кастомізації її відображення, що є одним із пунктів виконання задачі, а й дозволяє використовувати векторну (пошарову) версію карти. Додатковим плюсом цієї бібліотеки є те, що вона
можє використовувати апаратне прискорення у браузері (WebGL) для швидкого і плавного рендеру карти на сторінці. 

## 2. Реалізовані можливості 
- Карта України у векторі
- Відділення розміщуються на карті у вигляді різнокольорових маркерів
- Для .json який можна отримати з API я реалізував можливість його імпорту на базу даних, оскільки мій фронтенд поки не комунікує зі справжнім ендпоінтом на API
- Панель налаштувань: можливість вимикати мікрорайони на карті та редагувати обране відділення (змінити його статус на "Тимчасово не працює", при цьому статус також зберігається на базі даних) 
- Фільтрація відділень за містом та типом
- Розділив карту на адмін та клієнт (у другому варіанті панель налаштувань карти - відсутня)
- Кластеризація: маркери згруповані по кластерам
- Popups/Tooltips: при виборі відділення з'явится popup з детальною інфомацією про нього (потрібну для даної підказки інформацію я брав з поточної реалізації карти з сайту банку)

## 3. Керування шарами
Шари можуть бути легко вимкнені (відфільтровані), на даному етапі я зробив можливість вимикати лише мікрорайони (за замовчуванням - вимкнені), або вмикнути їх (даних фільтр не зберігається при перезавантаженні сторінки, створено для демонстрації можливостей мапи)
Код, який відповідає за керування шарами являє собою функцію: 
```
const handleDistrictToggle = (isVisible: boolean) => {
    const activeMap = map.value;
    if (!activeMap) return;
    const classes = ["continent", "hamlet", "isolated_dwelling"];
    if (isVisible) classes.push("neighbourhood");
    activeMap.setFilter('place_other', ["all", ["in", "class", ...classes], ["==", "$type", "Point"]]);
};
```
У даній функції використаний метод `setFilter` класу `maplibregl.Map`, метод викликається з інстансу карти, яка розміщена на сторінці і приймає у параметрах: назву шару,
назви класів об'єктів на обраному шарі `["all", ["in", "class", ...classes]` та службові параметри фільтру `["==", "$type", "Point"]`

При першому рендері карти 
```
m.on('load', async () => {
        handleDistrictToggle(false);
        ...
```
встановлюємо відображення на `false`

## 4. Проблеми та обмеження
1. Деякі об'єкти на мапі важко вимкнути, оскільки вони не виділені у окремі шари, для цього був використаний метод `setFilter`, якби мікрорайони були виділені на окремий шар, метод `setLayoutProperty` є більш легкою альтернативою
``` 
const districtLayers = ['place_suburb', 'place_neighbourhood', 'place_village', 'place_hamlet'];
    districtLayers.forEach(id => {
        if (activeMap.getLayer(id)) activeMap.setLayoutProperty(id, 'visibility', visibility);
    });
```
2. Великі Popups (Для відділень) можуть не поміщатися на маленьких дисплеях.
3. Через складну структуру даних відділень, на БД я вимушений був зберігати їхній розклад у JSON (для збереження моделі БД з однією таблицею)

## Посилання на репозиторій
URL: `https://github.com/PivnoiSensei/BankMap/new/master`
